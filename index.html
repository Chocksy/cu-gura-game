<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cu Gura p√¢nƒÉ la Urechi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-bottom: 30px;
        }

        .api-section {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .api-section input {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            width: 300px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .api-section input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .api-section button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            transition: transform 0.2s, background 0.2s;
        }

        .api-section button:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .card {
            background: linear-gradient(145deg, #e94560, #ff6b6b);
            border-radius: 24px;
            padding: 40px;
            min-width: 320px;
            max-width: 500px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px rgba(233, 69, 96, 0.4);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 80px rgba(233, 69, 96, 0.5);
        }

        .words {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.4;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .execution {
            background: rgba(0,0,0,0.2);
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 600;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .execution-icon {
            font-size: 1.8rem;
        }

        .generate-btn {
            margin-top: 30px;
            padding: 18px 50px;
            font-size: 1.3rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: linear-gradient(145deg, #00b4d8, #0077b6);
            color: white;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 10px 30px rgba(0, 180, 216, 0.4);
        }

        .generate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 180, 216, 0.5);
        }

        .generate-btn:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        .loading {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .error {
            color: #ff6b6b;
            margin-top: 15px;
            text-align: center;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status.connected {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }

        .status.disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }

        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .card { padding: 30px 20px; min-width: 280px; }
            .words { font-size: 1.5rem; }
            .execution { font-size: 1.1rem; }
            .generate-btn { padding: 15px 40px; font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <h1>üé≠ Cu Gura p√¢nƒÉ la Urechi</h1>
    <p class="subtitle">GenereazƒÉ o carte »ôi spune cuvintele!</p>

    <div class="api-section" id="apiSection">
        <input type="password" id="apiKey" placeholder="OpenRouter API Key">
        <button onclick="saveApiKey()">SalveazƒÉ</button>
    </div>

    <div class="status" id="status">‚ö™ FƒÉrƒÉ cheie API</div>

    <div class="card" id="card">
        <div class="words" id="words">ApasƒÉ butonul pentru a genera o carte!</div>
        <div class="execution" id="execution" style="display: none;">
            <span class="execution-icon" id="executionIcon"></span>
            <span id="executionText"></span>
        </div>
    </div>

    <button class="generate-btn" id="generateBtn" onclick="generateCard()">
        üé≤ GenereazƒÉ Carte
    </button>

    <p class="error" id="error"></p>

    <!-- API Key injected by server (will be replaced by entrypoint.sh) -->
    <script>window.OPENROUTER_API_KEY = "%%OPENROUTER_API_KEY%%";</script>

    <script>
        const OPENROUTER_URL = 'https://openrouter.ai/api/v1/chat/completions';
        const MODEL = 'openai/gpt-4o-mini';
        
        const EXECUTION_STYLES = [
            { text: 'Cu gura deschisƒÉ', icon: 'üòÆ' },
            { text: 'Cu limba √Æn cerul gurii', icon: 'ü§ê' },
            { text: 'Cu limba scoasƒÉ', icon: 'üòõ' },
            { text: 'Cu z√¢mbet', icon: 'üòä' }
        ];

        // Check for server-injected key first, then localStorage
        const SERVER_KEY = window.OPENROUTER_API_KEY !== '%%OPENROUTER_API_KEY%%' ? window.OPENROUTER_API_KEY : null;
        let apiKey = SERVER_KEY || localStorage.getItem('openrouter_api_key') || '';

        function init() {
            if (apiKey) {
                document.getElementById('apiSection').style.display = 'none';
                updateStatus(true, !!SERVER_KEY);
            } else {
                updateStatus(false);
            }
        }

        function saveApiKey() {
            const input = document.getElementById('apiKey');
            apiKey = input.value.trim();
            if (apiKey) {
                localStorage.setItem('openrouter_api_key', apiKey);
                document.getElementById('apiSection').style.display = 'none';
                updateStatus(true, false);
            }
        }

        function updateStatus(connected, isServer) {
            const status = document.getElementById('status');
            if (connected) {
                status.textContent = isServer ? 'üü¢ Cheie server' : 'üü¢ Cheie salvatƒÉ';
                status.className = 'status connected';
            } else {
                status.textContent = 'üî¥ FƒÉrƒÉ cheie API';
                status.className = 'status disconnected';
            }
        }

        async function generateCard() {
            if (!apiKey) {
                document.getElementById('error').textContent = 'Te rog introdu cheia API!';
                document.getElementById('apiSection').style.display = 'flex';
                return;
            }

            const btn = document.getElementById('generateBtn');
            const wordsEl = document.getElementById('words');
            const executionEl = document.getElementById('execution');
            const errorEl = document.getElementById('error');

            btn.disabled = true;
            btn.textContent = '‚è≥ Se genereazƒÉ...';
            btn.classList.add('loading');
            errorEl.textContent = '';
            executionEl.style.display = 'none';

            try {
                const response = await fetch(OPENROUTER_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Cu Gura pana la Urechi'
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [{
                            role: 'user',
                            content: `GenereazƒÉ exact √Æntre 1 »ôi 5 cuvinte sau expresii scurte √Æn limba rom√¢nƒÉ pentru un joc de ghicit. 
                            Cuvintele trebuie sƒÉ fie substantive comune, obiecte, animale, ac»õiuni sau expresii cunoscute care pot fi mimate sau spuse cu dificultate.
                            RƒÉspunde DOAR cu cuvintele separate prin virgulƒÉ, fƒÉrƒÉ explica»õii sau text adi»õional.
                            Exemple bune: "pisicƒÉ", "avion, casƒÉ", "a merge pe bicicletƒÉ", "floare, soare, nor"
                            Fii creativ »ôi variazƒÉ dificultatea!`
                        }],
                        max_tokens: 50,
                        temperature: 1.0
                    })
                });

                if (!response.ok) {
                    throw new Error(`Eroare API: ${response.status}`);
                }

                const data = await response.json();
                const words = data.choices[0].message.content.trim();
                
                // Random execution style
                const style = EXECUTION_STYLES[Math.floor(Math.random() * EXECUTION_STYLES.length)];

                wordsEl.textContent = words;
                document.getElementById('executionIcon').textContent = style.icon;
                document.getElementById('executionText').textContent = style.text;
                executionEl.style.display = 'flex';

            } catch (err) {
                console.error(err);
                errorEl.textContent = `Eroare: ${err.message}`;
                if (err.message.includes('401')) {
                    errorEl.textContent = 'Cheie API invalidƒÉ! Re√ÆncarcƒÉ pagina »ôi introdu o cheie validƒÉ.';
                    localStorage.removeItem('openrouter_api_key');
                    if (!SERVER_KEY) {
                        apiKey = '';
                        document.getElementById('apiSection').style.display = 'flex';
                        updateStatus(false);
                    }
                }
            } finally {
                btn.disabled = false;
                btn.textContent = 'üé≤ GenereazƒÉ Carte';
                btn.classList.remove('loading');
            }
        }

        // Reset API key function (for debugging)
        function resetKey() {
            localStorage.removeItem('openrouter_api_key');
            location.reload();
        }

        init();
    </script>
</body>
</html>
